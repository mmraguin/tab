<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>tala.</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700&family=DM+Mono:wght@400;500&display=swap">
<style>
@import url('https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700&family=DM+Mono:wght@400;500&display=swap');
:root {
  --bg:#0b0b0d;--surface:#141416;--surface2:#1e1e22;--surface3:#28282e;
  --border:#2a2a30;--border2:#363640;
  --accent:#2a9d9f;--accent-dim:rgba(42,157,159,0.10);--accent-border:rgba(42,157,159,0.25);
  --text:#ededf0;--text2:#9898a6;--muted:#60606e;
  --income:#4ade80;--income-dim:rgba(74,222,128,0.08);--income-border:rgba(74,222,128,0.20);
  --expense:#ff5c5c;--expense-dim:rgba(255,92,92,0.08);--expense-border:rgba(255,92,92,0.20);
  --danger:#e63946;--transfer:#b8a9e0;
  --warn:#c8922a;--warn-dim:rgba(200,146,42,0.08);--warn-border:rgba(200,146,42,0.25);
  --tab-h:60px;--safe-b:env(safe-area-inset-bottom,0px);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overflow:hidden}
body{font-family:'DM Sans',sans-serif;font-variant-numeric:tabular-nums;background:var(--bg);color:var(--text);display:flex;justify-content:center}
body::after{content:'';position:fixed;inset:0;z-index:9999;pointer-events:none;opacity:.025;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.035'/%3E%3C/svg%3E")}
.app{width:100%;max-width:430px;height:100%;display:flex;flex-direction:column;overflow:hidden}
.hdr{flex-shrink:0;padding:13px 14px 11px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border);background:rgba(11,11,13,.95);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);z-index:10}
.wordmark{font-family:'Syne',sans-serif;font-size:20px;font-weight:800;letter-spacing:-.03em}
.wordmark em{color:var(--accent);font-style:normal}
.hdr-r{display:flex;gap:6px;align-items:center}
.mnav{display:flex;align-items:center;gap:2px;background:var(--surface);border:1px solid var(--border);border-radius:20px;padding:4px 6px}
.marrow{background:none;border:none;color:var(--muted);cursor:pointer;font-size:16px;line-height:1;padding:0 4px;transition:color .15s}
.marrow:hover{color:var(--accent)}
.mlabel{font-family:'DM Mono',monospace;font-size:11px;font-weight:500;color:var(--text);min-width:68px;text-align:center;letter-spacing:.04em}
.hbtn{width:32px;height:32px;border-radius:10px;border:1px solid var(--border);background:var(--surface);color:var(--muted);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:14px;transition:all .15s;user-select:none}
.hbtn:active{transform:scale(.9);color:var(--accent)}
.pw{flex:1;overflow:hidden;position:relative}
.pages{display:flex;width:600%;height:100%;transition:transform .32s cubic-bezier(.22,1,.36,1)}
.page{width:16.6667%;height:100%;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;flex-shrink:0}
.page::-webkit-scrollbar{display:none}
.pi{padding:12px 12px 28px;display:flex;flex-direction:column;gap:10px}
.tabbar{flex-shrink:0;height:calc(var(--tab-h) + var(--safe-b));padding-bottom:var(--safe-b);border-top:1px solid var(--border);background:rgba(20,20,22,.92);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);display:flex;z-index:10}
.tab{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;cursor:pointer;color:var(--muted);padding-top:4px;transition:color .15s;user-select:none}
.tab:active{transform:scale(.88)}
.tab.active{color:var(--accent)}
.ti{width:20px;height:20px;position:relative}
.ti svg{width:100%;height:100%;stroke:currentColor;fill:none;stroke-width:1.75;stroke-linecap:round;stroke-linejoin:round}
.tlabel{font-size:9px;font-weight:600;letter-spacing:.01em}
.tbadge{position:absolute;top:-3px;right:-7px;background:var(--expense);color:#fff;font-family:'DM Mono',monospace;font-size:8px;font-weight:500;border-radius:10px;padding:1px 4px;min-width:14px;text-align:center}
.sc{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:48px 20px;display:flex;flex-direction:column;align-items:center;gap:14px}
.pr{width:40px;height:40px;position:relative;display:flex;align-items:center;justify-content:center}
.pr::before,.pr::after{content:'';position:absolute;border:1.5px solid var(--accent);border-radius:50%;animation:pout 1.4s ease-out infinite}
.pr::after{animation-delay:.6s}
@keyframes pout{0%{width:10px;height:10px;opacity:1}100%{width:40px;height:40px;opacity:0}}
.pdot{width:8px;height:8px;border-radius:50%;background:var(--accent)}
.stext{font-size:13px;color:var(--text2);text-align:center;line-height:1.5}
.hero{background:var(--surface);border:1px solid var(--border);border-radius:20px;padding:18px 20px;position:relative;overflow:hidden;animation:fadeUp .2s cubic-bezier(.22,1,.36,1)}
.hglow{position:absolute;top:-60px;left:-40px;width:220px;height:220px;border-radius:50%;pointer-events:none}
.hglow.pos{background:radial-gradient(circle,rgba(74,222,128,.12) 0%,transparent 70%)}
.hglow.warn{background:radial-gradient(circle,rgba(200,146,42,.12) 0%,transparent 70%)}
.hglow.neg{background:radial-gradient(circle,rgba(255,92,92,.12) 0%,transparent 70%)}
.hi{position:relative;z-index:1}
.hmlbl{font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.1em;text-transform:uppercase;color:var(--muted);margin-bottom:5px}
.hamt{font-variant-numeric:tabular-nums;font-size:36px;font-weight:700;letter-spacing:-.025em;line-height:1}
.hamt.pos{color:var(--income)}.hamt.warn{color:var(--warn)}.hamt.neg{color:var(--expense)}
.hstats{display:grid;grid-template-columns:1fr 1fr 1fr;border-top:1px solid var(--border);padding-top:12px;margin-top:14px;position:relative;z-index:1}
.hs{text-align:center;padding:0 4px;border-right:1px solid var(--border)}.hs:last-child{border-right:none}
.hslbl{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:.08em;text-transform:uppercase;color:var(--muted);margin-bottom:3px}
.hsval{font-size:13px;font-weight:600;font-variant-numeric:tabular-nums}
.ic{color:var(--income)}.ec{color:var(--expense)}.nc{color:var(--text2)}
.ts{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);text-align:center;padding:4px 0 8px}
.etitle{font-family:'Syne',sans-serif;font-size:15px;font-weight:700;color:var(--danger);margin-bottom:8px}
.emsg{font-size:13px;color:var(--text2);margin-bottom:14px}
.btn-retry{background:var(--danger);color:#fff;border:none;border-radius:10px;padding:10px 24px;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer}
@keyframes fadeUp{from{opacity:0;transform:translateY(7px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>
<div class="app">
  <div class="hdr">
    <div class="wordmark">tala<em>.</em></div>
    <div class="hdr-r">
      <div class="mnav">
        <button class="marrow" onclick="changeMonth(-1)">&#8249;</button>
        <div class="mlabel" id="mlabel">---</div>
        <button class="marrow" onclick="changeMonth(1)">&#8250;</button>
      </div>
      <div class="hbtn" id="refbtn" onclick="loadData()">&#8635;</div>
    </div>
  </div>
  <div class="pw" id="pw">
    <div class="pages" id="pages">
      <div class="page" id="p0"><div class="pi" id="hc"><div class="sc"><div class="pr"><div class="pdot"></div></div><div class="stext">Loading your budget...</div></div></div></div>
      <div class="page" id="p1"><div class="pi" id="pc"><div class="sc"><div class="pr"><div class="pdot"></div></div><div class="stext">Loading...</div></div></div></div>
      <div class="page" id="p2"><div class="pi" id="sc2"><div class="sc"><div class="pr"><div class="pdot"></div></div><div class="stext">Loading...</div></div></div></div>
      <div class="page" id="p3"><div class="pi" id="ac"><div class="sc"><div class="pr"><div class="pdot"></div></div><div class="stext">Loading...</div></div></div></div>
      <div class="page" id="p4"><div class="pi" id="gc"><div class="sc"><div class="pr"><div class="pdot"></div></div><div class="stext">Loading...</div></div></div></div>
      <div class="page" id="p5"><div class="pi" id="rc"><div class="sc"><div class="pr"><div class="pdot"></div></div><div class="stext">Loading...</div></div></div></div>
    </div>
  </div>
  <div class="tabbar">
    <div class="tab active" data-tab="0" onclick="switchTab(0)">
      <div class="ti"><svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></div>
      <div class="tlabel">Home</div>
    </div>
    <div class="tab" data-tab="1" onclick="switchTab(1)">
      <div class="ti" style="position:relative">
        <svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
        <span class="tbadge" id="planbadge" style="display:none">0</span>
      </div>
      <div class="tlabel">Plan</div>
    </div>
    <div class="tab" data-tab="2" onclick="switchTab(2)">
      <div class="ti"><svg viewBox="0 0 24 24"><path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"/></svg></div>
      <div class="tlabel">Spend</div>
    </div>
    <div class="tab" data-tab="3" onclick="switchTab(3)">
      <div class="ti"><svg viewBox="0 0 24 24"><rect x="2" y="5" width="20" height="14" rx="2"/><path d="M2 10h20"/></svg></div>
      <div class="tlabel">Accounts</div>
    </div>
    <div class="tab" data-tab="4" onclick="switchTab(4)">
      <div class="ti"><svg viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M12 12v10M12 22l4-4M12 22l-4-4"/></svg></div>
      <div class="tlabel">Goals</div>
    </div>
    <div class="tab" data-tab="5" onclick="switchTab(5)">
      <div class="ti"><svg viewBox="0 0 24 24"><path d="M3 3v18h18"/><path d="M18 17l-3-3-4 4-4-4-4 4"/></svg></div>
      <div class="tlabel">Reports</div>
    </div>
  </div>
</div>
<script>
var WEBHOOK='https://script.google.com/macros/s/AKfycbxArmvsbhZIthFv1qqy2cEl5pRRZin2-V-RFdpbuOh--1iESw4m1E8NXo3XtaKqpu-nng/exec';
var ACCOUNTS=['BDO','BPI','Cash','GCash','Maribank','Maya','UnionBank','UnionBank Credit'];
var MONTHS=['January','February','March','April','May','June','July','August','September','October','November','December'];
var GORDER=['Income','Home','Pets','Health','Quality Of Life','Stellar Rebels','Sinking','Emergency','Goals'];

var viewMonth=new Date();
viewMonth.setDate(1);
var curTab=0;
var rawB=null,rawA=null,rawS=null;
var parsed=null;
var lastUp=null;

function parseDate(v){
if(v==null||v===undefined)return null;
if(v instanceof Date)return isNaN(v.getTime())?null:v;
var s=String(v).trim();
if(!s||s===’-’||s===’–’)return null;
var m=s.match(/^(\d{1,2})/(\d{1,2})/(\d{4})$/);
if(m)return new Date(+m[3],+m[1]-1,+m[2]);
var m2=s.match(/^(\d{4})-(\d{2})-(\d{2})/);
if(m2)return new Date(+m2[1],+m2[2]-1,+m2[3]);
if(/^\d+$/.test(s)){
var n=parseInt(s,10);
if(n>40000&&n<60000){
var e=new Date(Date.UTC(1899,11,30)+n*86400000);
return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate());
}
}
var d=new Date(v);
return isNaN(d.getTime())?null:d;
}

function pn(v){
if(typeof v===‘number’)return v;
return parseFloat(String(v||‘0’).replace(/[^0-9.-]/g,’’))||0;
}

function peso(n){
return ‘\u20b1’+Math.abs(n).toLocaleString(‘en-PH’,{minimumFractionDigits:2,maximumFractionDigits:2});
}

function sh(n){
var a=Math.abs(n);
if(a>=1e6)return ‘\u20b1’+(a/1e6).toFixed(1)+‘M’;
if(a>=1e3)return ‘\u20b1’+(a/1e3).toFixed(1)+‘k’;
return ‘\u20b1’+a.toFixed(0);
}

function bHdr(rows){
if(!rows||!rows.length)return false;
return!parseDate(String(rows[0][5]||’’));
}

function aHdr(rows){
if(!rows||!rows.length)return false;
return!parseDate(String(rows[0][0]||’’));
}

function sHdr(rows){
if(!rows||!rows.length)return false;
return!parseDate(String(rows[0][0]||’’));
}

function setML(){
document.getElementById(‘mlabel’).textContent=MONTHS[viewMonth.getMonth()].slice(0,3).toUpperCase()+’ ’+viewMonth.getFullYear();
}

function changeMonth(d){
viewMonth=new Date(viewMonth.getFullYear(),viewMonth.getMonth()+d,1);
setML();
if(rawB){
parsed=parseAll();
renderCur();
}
}

function switchTab(idx){
curTab=idx;
document.querySelectorAll(’.tab’).forEach(function(t){
t.classList.toggle(‘active’,+t.dataset.tab===idx);
});
document.getElementById(‘pages’).style.transform=‘translateX(-’+((idx/6)*100)+’%)’;
if(parsed)renderCur();
}

function renderCur(){
if(curTab===0)renderHome();
else{
document.getElementById(‘p’+curTab).innerHTML=’<div class="hero"><div class="hi"><div class="hmlbl">Tab ‘+curTab+’</div><div class="hamt pos">Coming soon</div></div></div>’;
}
}

function loadData(){
var btn=document.getElementById(‘refbtn’);
btn.style.opacity=‘0.35’;
btn.style.pointerEvents=‘none’;

fetch(WEBHOOK)
.then(function(r){
if(!r.ok)throw new Error(’HTTP ’+r.status);
return r.json();
})
.then(function(j){
console.log(‘Raw response:’,j);
if(j.status===‘error’)throw new Error(j.message);
if(!j.budget||!j.activity||!j.snapshot)throw new Error(‘Missing data sheets’);

```
  rawB=j.budget;
  rawA=j.activity;
  rawS=j.snapshot;
  lastUp=new Date();
  
  parsed=parseAll();
  console.log('Parsed data:',parsed);
  renderCur();
  
  try{
    localStorage.setItem('tala_v1',JSON.stringify({b:rawB,a:rawA,s:rawS,ts:lastUp.toISOString()}));
  }catch(e){
    console.warn('LocalStorage save failed:',e);
  }
})
.catch(function(e){
  console.error('Load error:',e);
  showErr(e.message);
})
.finally(function(){
  btn.style.opacity='';
  btn.style.pointerEvents='';
});
```

}

function showErr(msg){
var h=’<div class="sc"><div class="etitle">Load failed</div><div class="emsg">’+msg+’</div><button class="btn-retry" onclick="loadData()">Retry</button></div>’;
[‘hc’,‘pc’,‘sc2’,‘ac’,‘gc’,‘rc’].forEach(function(id){
var el=document.getElementById(id);
if(el)el.innerHTML=h;
});
}

function parseAll(){
var vm=viewMonth.getMonth();
var vy=viewMonth.getFullYear();

var bData=bHdr(rawB)?rawB.slice(1):rawB;
var aData=aHdr(rawA)?rawA.slice(1):rawA;
var sData=sHdr(rawS)?rawS.slice(1):rawS;

var bRows=bData.filter(function(row){
var d=parseDate(row[5]);
return d&&d.getMonth()===vm&&d.getFullYear()===vy;
});

var rta=0,atm=0,inflowExt=0,outflowExt=0,cashStart=0,cashEnd=0;
for(var i=0;i<sData.length;i++){
var sr=sData[i];
var sd=parseDate(sr[0]);
if(sd&&sd.getMonth()===vm&&sd.getFullYear()===vy){
cashStart=pn(sr[1]);
inflowExt=pn(sr[2]);
atm=pn(sr[3]);
outflowExt=pn(sr[4]);
cashEnd=pn(sr[5]);
rta=pn(sr[6]);
break;
}
}

var monthAct=aData.filter(function(row){
var d=parseDate(row[0]);
return d&&d.getMonth()===vm&&d.getFullYear()===vy;
});

var expRows=monthAct.filter(function(r){
return String(r[1]).trim()===‘Expense’;
});

var incRows=monthAct.filter(function(r){
return String(r[1]).trim()===‘Income’;
});

var totalInc=incRows.reduce(function(s,r){
return s+Math.abs(pn(r[2]));
},0);

var totalExp=expRows.reduce(function(s,r){
return s+Math.abs(pn(r[2]));
},0);

var totalAssignedAll=bRows.reduce(function(s,row){
return s+pn(row[11]);
},0);

return{
readyToAssign:rta,
assignedThisMonth:atm,
inflowExt:inflowExt,
outflowExt:outflowExt,
cashStart:cashStart,
cashEnd:cashEnd,
totalInc:totalInc,
totalExp:totalExp,
totalAssignedAll:totalAssignedAll,
categories:bRows.length
};
}

function renderHome(){
var p=parsed;
var el=document.getElementById(‘hc’);

var hs=p.readyToAssign<0?‘neg’:p.readyToAssign<p.totalInc*0.1?‘warn’:‘pos’;

var html=’<div class="hero"><div class="hglow '+hs+'"></div><div class="hi">’
+’<div class="hmlbl">Left to Assign</div>’
+’<div class="hamt '+hs+'" style="font-size:44px;margin:4px 0">’
+(p.readyToAssign<0?’−’:’’)+peso(Math.abs(p.readyToAssign))
+’</div>’
+’<div style="font-size:12px;color:var(--text2);margin-top:8px;position:relative;z-index:1">’
+‘From ‘+peso(p.totalInc)+’ income this period’
+’</div></div>’
+’<div class="hstats">’
+’<div class="hs"><div class="hslbl">Income</div><div class="hsval ic">’+sh(p.totalInc)+’</div></div>’
+’<div class="hs"><div class="hslbl">Assigned</div><div class="hsval nc">’+sh(p.totalAssignedAll)+’</div></div>’
+’<div class="hs"><div class="hslbl">Spent</div><div class="hsval ec">’+sh(p.totalExp)+’</div></div>’
+’</div></div>’
+’<div class="ts">’+p.categories+’ categories loaded · ’
+(lastUp?lastUp.toLocaleTimeString(‘en-PH’,{hour:‘2-digit’,minute:‘2-digit’}):’’)
+’</div>’;

el.innerHTML=html;
}

setML();
loadData();
</script>

</body>
</html>